(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{198:function(e,t,i){},199:function(e,t,i){},275:function(e,t,i){},294:function(e,t,i){"use strict";var n=i(198);i.n(n).a},316:function(e,t,i){"use strict";var n=i(199);i.n(n).a},319:function(e,t,i){"use strict";i.r(t);i(141),i(144),i(275);var n=i(218),a=(i(219),i(156),i(157),i(158)),o=i.n(a),r=o.a.GraphObject.make,s=["nodeTemplate","linkTemplate","nodeTemplateMap","linkTemplateMap","groupTemplate","groupTemplateMap"],l={name:"XdhGo",provide:function(){return{$:r,go:o.a,diagram:this.diagram}},props:{width:{type:String,default:"100%"},height:{type:String,default:"100%"},nodeTemplate:{type:Function},linkTemplate:{type:Function},nodeTemplateMap:{type:Function},linkTemplateMap:{type:Function},groupTemplate:{type:Function},groupTemplateMap:{type:Function},type:{type:String,default:"Model",validator:function(e){return["Model","GraphLinksModel","TreeModel"].includes(e)}},nodes:{type:Array},links:{type:Array},config:{type:[Object,Function]},layout:{type:Function},events:{type:Object,default:function(){return Object.create(null)}},modelConfig:{type:[Object,Function]},palette:{type:Boolean,default:!1}},data:function(){return{diagram:null,htmlInfo:{}}},computed:{styles:function(){return{width:this.width,height:this.height}}},watch:{nodes:function(e){this.loadData(e,this.links)},links:function(e){this.loadData(this.nodes,e)}},methods:{loadData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.diagram){var i=this.diagram.model;i.nodeDataArray=e,"GraphLinksModel"===this.type&&(i.linkDataArray=t),this.diagram.updateAllRelationshipsFromData()}},loadTemplate:function(){var e=this;s.forEach(function(t){e.setTemplate(t,e[t])})},setTemplate:function(e,t){if(!s.includes(e))throw new Error("setTemplate不支持模板类型".concat(e));"function"==typeof t&&(this.diagram[e]=t(r,o.a,this))},loadLayout:function(e){e&&(this.diagram.layout=e(r,o.a,this))},bindEvents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.diagram)for(var t in e)if(e.hasOwnProperty(t)){var i=this.listeners[t]=e[t].bind(this);this.diagram.addDiagramListener(t,i)}},unbindEvents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.diagram)for(var t in e)if(e.hasOwnProperty(t)){var i=this.listeners[t]||e[t];this.diagram.removeDiagramListener(t,i),delete this.listeners[t]}},findNode:function(e,t){if(!this.diagram)return null;var i=this.diagram.model,n=i.nodeDataArray||[],a="function"==typeof e?n.find(e):i.findNodeDataForKey(e);return t?this.diagram.findNodeForData(a):a},findNodes:function(e,t){var i=this;if(!this.diagram)return[];if(!("function"==typeof e))throw new Error("findNodes的filter参数必须要是函数");var n=(this.diagram.model.nodeDataArray||[]).filter(e);return t?n.map(function(e){return i.diagram.findNodeForData(e)}):n},findLink:function(e,t){if(!this.diagram)return null;var i=this.diagram.model,n=i.linkDataArray||[],a="function"==typeof e?n.find(e):i.findLinkDataForKey(e);return t?this.diagram.findLinkForData(a):a},findLinks:function(e,t){var i=this;if(!this.diagram)return[];if(!("function"==typeof e))throw new Error("findLinks的filter参数必须要是函数");var n=(this.diagram.model.linkDataArray||[]).filter(e);return t?n.map(function(e){return i.diagram.findLinkForData(e)}):n},findChildLinks:function(e){if(!e||!this.diagram)return[];var t=this.diagram.model.linkDataArray||[],i=[];return function e(n){t.filter(function(e){return e.from===n}).forEach(function(t){i.push(t),e(t.to)})}(e),i},findChildNodes:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parent",n=[];if("GraphLinksModel"===this.type){var a=this.findChildLinks(e);a.forEach(function(e){n.push(t.findNode(e.to))})}else if("TreeModel"===this.type){var o=this.diagram.model,r=o.nodeDataArray||[],s=function e(t){r.filter(function(e){return e[i]===t}).forEach(function(t){n.push(t),e(t.key)})};s(e)}return n},update:function(e,t,i){if(this.diagram){var a=Object(n.a)(t);if(!["string","object"].includes(a))throw new Error("update的参数 props 必须事string 或 object类型");var o=this.diagram.model;if(this.diagram.startTransaction("update"),"string"===a)o.set(e,t,i);else for(var r in t)t.hasOwnProperty(r)&&o.set(e,r,t[r]);this.diagram.commitTransaction("update")}},addNode:function(e){if(this.diagram){var t=this.diagram.model;this.diagram.startTransaction("addNode"),Array.isArray(e)?t.addNodeDataCollection(e):t.addNodeData(e),this.diagram.commitTransaction("addNode")}},addLink:function(e){if(this.diagram){var t=this.diagram.model;this.diagram.startTransaction("addLink"),Array.isArray(e)?t.addLinkDataCollection(e):t.addLinkData(e),this.diagram.commitTransaction("addLink")}},removeNode:function(e){if(this.diagram&&("string"==typeof e&&(e=this.findNode(e)),e)){var t=this.diagram.model;this.diagram.startTransaction("removeNode"),Array.isArray(e)?t.removeNodeDataCollection(e):t.removeNodeData(e),this.diagram.commitTransaction("removeNode")}},removeLink:function(e){if(this.diagram&&"GraphLinksModel"===this.type&&("string"==typeof e&&(e=this.findLink(e)),e)){var t=this.diagram.model;this.diagram.startTransaction("removeLink"),Array.isArray(e)?t.removeLinkDataCollection(e):t.removeLinkData(e),this.diagram.commitTransaction("removeLink")}},removeChild:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parent",i=this.findChildNodes(e,t),n=this.findChildLinks(e,t);this.diagram.startTransaction("removeChild"),this.removeNode(i),this.removeLink(n),this.diagram.commitTransaction("removeChild")},clear:function(){if(this.diagram){var e=this.diagram.model;this.diagram.startTransaction("clear"),e.clear(),this.diagram.commitTransaction("clear")}},toJson:function(){return this.diagram?this.diagram.model.toJson():JSON.stringify({})},fromJson:function(e){this.diagram&&(this.diagram.model=o.a.Model.fromJson("string"==typeof e?e:JSON.stringify(e)))},resize:function(){this.diagram&&this.diagram.requestUpdate()},getHtmlInfo:function(){var e=this;this.$children.forEach(function(t){"XdhGoHtml"===t.name&&(console.log(t),e.htmlInfo[t.menuName]=t.bindMenu(),t.appendToBody&&e.$el.parentNode.appendChild(t.$el))})}},mounted:function(){this.diagram=r(this.palette?o.a.Palette:o.a.Diagram,this.$el,"function"==typeof this.config?this.config(r,o.a):this.config||{}),this.getHtmlInfo(),this.loadTemplate(),this.diagram.model=r(o.a[this.type],"function"==typeof this.modelConfig?this.modelConfig(r,o.a):this.modelConfig||{}),this.loadLayout(this.layout),this.loadData(this.nodes,this.links),this.bindEvents(this.events),this.$emit("on-ready",this.diagram,r,o.a)},beforeDestroy:function(){this.unbindEvents(this.events),this.diagram.div=null},created:function(){this.go=o.a,this.diagram=null,this.listeners={}}},c=i(16),d=Object(c.a)(l,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"xdh-go",style:this.styles},[this._t("default")],2)},[],!1,null,null,null).exports;d.install=function(e){e.component(d.name,d)};var u=d,h={name:"XdhGoHtml",inject:["$","go","diagram"],props:{appendToBody:{type:Boolean,default:!0},menuName:{type:String,default:""},menuStyle:{type:Object,default:function(){return{"z-index":1e4,position:"fixed"}}},beforeShowMenu:{type:Function,default:function(){}},showContextMenu:{type:Function},hideContextMenu:{type:Function},autoHide:{type:Boolean,default:!0}},data:function(){return{menu:null,menuObj:null,name:"XdhGoHtml"}},computed:{},methods:{bindMenu:function(){var e=this.go,t=this.$;this.menuObj=this.$children[0],this.menu=this.$children[0].$el,this.menu.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},!1);var i={show:this.showMenu,mainElement:this.menu};return this.autoHide&&(i.hide=this.hideMenu),t(e.HTMLInfo,i)},showMenu:function(e,t,i){if(this.beforeShowMenu(e,t,i,this.menu),this.showContextMenu)this.showContextMenu(e,t,i,this.menu);else{this.menu.style.display="block";var n=t.lastInput.event;this.menu.style.left=n.pageX+"px",this.menu.style.top=n.pageY+"px"}},hideMenu:function(e,t){this.hideContextMenu?this.hideContextMenu(e,t,this.menu):this.menu.style.display="none"}}},f=Object(c.a)(h,function(){var e=this.$createElement;return(this._self._c||e)("div",{style:this.menuStyle},[this._t("default")],2)},[],!1,null,"24ab5d02",null).exports;f.install=function(e){e.component(f.name,f)};var m=f,p={name:"XdhGoTooltip",components:{},props:{text:{type:String,default:"tips"}},data:function(){return{}},computed:{},methods:{},created:function(){},beforeDestroy:function(){this.$el.parentNode.removeChild(this.$el)}},g=Object(c.a)(p,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"xdh-go-tooltip"},[this._t("default",[t("div",{staticClass:"tooltip-text"},[this._v("\n       "+this._s(this.text)+"\n    ")])])],2)},[],!1,null,"64c13f06",null).exports;g.install=function(e){e.component(g.name,g)};var v=g,y=(i(284),i(174),i(287));i(290),i(291);function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function k(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?b(i,!0).forEach(function(t){Object(y.a)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var _={name:"XdhGoCircleMenu",props:{angleRange:{type:Array,default:function(){return[-30,210]}},propMap:{type:Object,default:function(){return{text:"text",subMenu:"subMenu"}}},itemKey:{type:String,default:"text"},innerRadius:{type:Number,default:60},itemWidth:{type:Number,default:100},subRangeLimit:Boolean,trigger:{type:String,default:"click"},menuList:{type:Array,default:function(){return[]}},itemStyle:{type:Object,default:function(){return{color:"#333"}}},activeColor:{type:String,default:"rgba(255, 102, 0, 0.5)"},normalColor:{type:String,default:"rgba(140, 197, 255, 0.8)"},hoverColor:{type:String,default:""},fixed:{type:Boolean},textRotate:{type:Boolean},itemGap:{type:Number,default:5}},computed:{comHoverColor:function(){return this.hoverColor||this.activeColor},menuStyle:function(){return this.fixed?"width: ".concat(2*(this.innerRadius+this.itemWidth),"px;\n          height: ").concat(2*(this.innerRadius+this.itemWidth),"px;\n          "):""},fixedOffset:function(){var e=this.innerRadius+this.itemWidth;return this.fixed?e:0},maskStyle:function(){return"\n          width:".concat(2*this.innerRadius,"px;\n          height:").concat(2*this.innerRadius,"px;\n          margin-left: ").concat(-this.innerRadius+this.fixedOffset,"px;\n          margin-top: ").concat(-this.innerRadius+this.fixedOffset,"px;\n          ")}},watch:{angleRange:{deep:!0,handler:function(e){this.resetMenu()}},menuList:{deep:!0,immediate:!0,handler:function(e){this.resetMenu()}},innerRadius:function(e){this.resetMenu()},itemWidth:function(e){this.resetMenu()}},data:function(){return{activeMenus:[],menuMap:{},menuLevels:[],tPropMap:{text:"text",subMenu:"subMenu"},triggerMap:{click:["click"],mouseover:["mouseenter"]},hoverItem:"",mouseLeaveTimeout:null}},methods:{resetMenu:function(){this.calList(this.menuList,0,"root"),this.initLevels(),this.activeMenus=[]},initLevels:function(){var e=this;this.menuLevels=[k({},this.menuMap.level0,{menuList:this.menuMap.level0.item_root},this.calCircle(this.menuMap.level0.item_root))],this.$nextTick(function(){setTimeout(function(){e.menuLevels[0].opened=!0},210)})},calCircle:function(e,t,i){var n,a,o,r=e.length;if(t){a=t.liWidth+5,o=t.start+i*t.itemAngle+t.itemAngle/2;var s,l,c=r*(t.liWidth*t.itemAngle/(a+this.itemWidth));this.subRangeLimit?c>=Math.abs(this.angleRange[0]-this.angleRange[1])?(s=this.angleRange[0],l=this.angleRange[1]):o-c/2<=this.angleRange[0]?l=(s=this.angleRange[0])+c:o+c/2>=this.angleRange[1]?s=(l=this.angleRange[1])-c:(s=o-c/2,l=o+c/2):(c>360&&(c=360),s=o-c/2,l=o+c/2),n=[s,l]}else{if(!(this.angleRange instanceof Array&&2===this.angleRange.length))throw new Error("angleRange参数错误");n=this.angleRange,a=this.innerRadius,o=this.angleRange[0]+Math.abs(this.angleRange[0]-this.angleRange[1])/2}var d=Math.abs(n[0]-n[1]),u=parseFloat(d/r),h=a+this.itemWidth,f=2*h;return{start:n[0],itemAngle:u,liWidth:h,menuWidth:f,innerRadius:a,centerAngle:o,opened:!1}},calList:function(e,t,i){var n=this,a=[];e.forEach(function(e,i){e[n.tPropMap.subMenu]&&n.calList(e[n.tPropMap.subMenu],t+1,e[n.itemKey]),e.levelNum=t,a.push(e)}),this.menuMap["level"+t]||(this.menuMap["level"+t]={zIndex:9999-t,levelNum:t}),this.menuMap["level"+t]["item_"+i]=a},cxcommand:function(e,t,i,n){var a=this;switch(e.type){case"mouseleave":this.hoverItem="",this.mouseLeaveTimeout=setTimeout(function(){a.hide()},800);break;case"mouseenter":this.hoverItem="item_"+t[this.itemKey],this.mouseLeaveTimeout&&clearTimeout(this.mouseLeaveTimeout)}if(t[this.tPropMap.subMenu]){if(!this.triggerMap[this.trigger].includes(e.type))return;this.reduceMenu(i.levelNum+1).then(function(){var e=a.menuMap["level"+(t.levelNum+1)],o=e["item_"+t[a.itemKey]];a.activeMenus.push("item_"+t[a.itemKey]),a.$nextTick(function(){var t=k({},e,{menuList:o},a.calCircle(o,i,n));a.menuLevels.push(t),a.$nextTick(function(){setTimeout(function(){t.opened=!0},210)})})})}else{if("click"!==e.type)return void this.reduceMenu(i.levelNum+1);if(t.disabled)return;this.reduceMenu(i.levelNum+1).then(function(){a.$emit("on-item-click",e,t)})}},reduceMenu:function(e){var t=this;return new Promise(function(i,n){t.menuLevels.length>e?(t.menuLevels[t.menuLevels.length-1].opened=!1,setTimeout(function(){t.menuLevels.pop(),t.activeMenus.pop(),t.reduceMenu(e).then(function(){i()})},0)):i()})},show:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{left:0,top:0};this.$el.style.display="block",this.$el.style.left=t.left+"px",this.$el.style.top=t.top+"px",setTimeout(function(){e.opened=!0},200)},hide:function(){var e=this;this.reduceMenu(1).then(function(){e.fixed||(e.$el.style.display="none")})}},created:function(){this.tPropMap=Object.assign({},{text:"text",subMenu:"subMenu"},this.propMap)},mounted:function(){},beforeDestroy:function(){this.$el.parentNode.removeChild(this.$el)}},w=(i(294),Object(c.a)(_,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"circle-menus":!0,fixed:e.fixed},style:e.menuStyle},[i("div",{staticClass:"center-mask",style:e.maskStyle,on:{click:function(t){return e.hide()}}},[e._t("center-btn",null,{menuList:e.menuList,menuLevels:e.menuLevels})],2),e._v(" "),e._l(e.menuLevels,function(t,n){return i("div",{key:n,class:{"circle-menu":!0,opened:t.opened},style:"\n      width: "+t.menuWidth+"px;\n        height: "+t.menuWidth+"px;\n        margin-top: "+(-t.liWidth+e.fixedOffset)+"px;\n        margin-left: "+(-t.liWidth+e.fixedOffset)+"px;\n        z-index: "+t.zIndex+";\n      "},[i("ul",e._l(t.menuList,function(n,a){return i("li",{key:a,class:{disabled:n.disabled,invisible:!1===n.visible},style:t.opened?"\n          transform: rotate("+(t.start+a*t.itemAngle)+"deg) skew("+(90-t.itemAngle+1)+"deg);\n          width:"+t.liWidth+"px;\n          height:"+t.liWidth+"px;\n          margin-left: -"+t.liWidth+"px;\n          ":"\n          transform: rotate("+(t.centerAngle-t.itemAngle/2)+"deg) skew("+(90-t.itemAngle+1)+"deg);\n          width:"+t.liWidth+"px;\n          height:"+t.liWidth+"px;\n          margin-left: -"+t.liWidth+"px;\n          ",on:{mouseenter:function(i){return e.cxcommand(i,n,t,a)},click:function(i){return e.cxcommand(i,n,t,a)},mouseleave:function(i){return e.cxcommand(i,n,t,a)}}},[i("a",{staticClass:"item-content",style:"\n            background: radial-gradient(transparent "+t.innerRadius+"px, "+(e.activeMenus.includes("item_"+n[e.itemKey])?e.activeColor:e.hoverItem==="item_"+n[e.itemKey]?e.comHoverColor:e.normalColor)+" "+t.innerRadius+"px);\n            width: "+t.menuWidth+"px;\n            height: "+t.menuWidth+"px;\n            right: -"+t.liWidth+"px;\n            bottom: -"+t.liWidth+"px;\n            transform: skew(-"+(90-t.itemAngle+1)+"deg) rotate(-"+(90-t.itemAngle/2)+"deg) scale(1);\n            "},[i("div",{style:e.textRotate?"transform: rotate("+-(t.start+a*t.itemAngle-(90-t.itemAngle/2))+"deg);height:"+(e.itemWidth-8)+"px;":"height:${itemWidth - 8}px;"},[e._t("list-item",[i("a",{staticClass:"item-text",style:Object.assign({},{"line-height":e.itemWidth+"px"},e.itemStyle),attrs:{href:"#",target:"_self"}},[e._v(e._s(n[e.propMap.text]))])],{item:n})],2)])])}),0)])})],2)},[],!1,null,"65a6aa11",null).exports);w.install=function(e){e.component(w.name,w)};var x=w,C={name:"XdhGoOverview",inject:["$","go","diagram"],components:{},props:{divStyle:{type:Object,default:function(){return{}}}},data:function(){return{name:"XdhGoOverview",defaultStyle:{position:"absolute",left:"10px",bottom:"10px",width:"150px",height:"150px",border:"2px solid #75a3fa","z-index":9999,"background-color":"rgba(100,100,100,0.4)"},style:{}}},computed:{},methods:{},mounted:function(){var e=this,t=this.$el,i=this.go;this.$parent.$once("on-ready",function(){new i.Overview(t).observed=e.$parent.diagram,e.$parent.$el.appendChild(t)})},created:function(){this.style=Object.assign({},this.defaultStyle,this.divStyle)}},D=Object(c.a)(C,function(){var e=this.$createElement;return(this._self._c||e)("div",{style:this.style})},[],!1,null,"008e81fa",null).exports;D.install=function(e){e.component(D.name,D)};var L=D,M={name:"XdhGoSnapshot",components:{},props:{diagram:{type:Object,default:null},options:{type:Object,default:function(){return{}}}},data:function(){return{imageDefaultOption:{scale:1,size:new o.a.Size(100,100),type:"image/png"},svgDefaultOption:{scale:1,size:new o.a.Size(100,100)}}},computed:{},methods:{makeImage:function(){var e=this.diagram.documentBounds,t=new o.a.Size(e.width+20,e.height+20),i=Object.assign({},this.imageDefaultOption,{size:t}),n=this.diagram.makeImage(i);this.$emit("on-snap","image",n)},makeImageData:function(){var e=this.diagram.documentBounds,t=new o.a.Size(e.width+20,e.height+20),i=Object.assign({},this.imageDefaultOption,{size:t}),n=this.diagram.makeImageData(i);this.$emit("on-snap","imageData",n)},makeSvg:function(){var e=this.diagram.documentBounds,t=new o.a.Size(e.width+20,e.height+20),i=Object.assign({},this.svgDefaultOption,{size:t}),n=this.diagram.makeSvg(i);this.$emit("on-snap","svg",n)}},created:function(){}},S=Object(c.a)(M,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[e._t("default",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeImage()}}},[e._v("保存图片")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeImageData()}}},[e._v("保存图片字符串")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSvg()}}},[e._v("保存svg")])],{makeImage:e.makeImage,makeImageData:e.makeImageData,makeSvg:e.makeSvg})],2)},[],!1,null,"2dff3790",null).exports;S.install=function(e){e.component(S.name,S)};var O=S,T=(i(295),i(296),i(222)),j=i(223),N=i(322),A=i(224),$=i(321),E=i(320),P=i(3),R=i(0),z=function(){},F={handle:null,axis:null,delay:100,range:{left:-1e4,top:-1e4,width:1e4,height:1e4},target:null,clone:!1,revert:!0,group:null,disabled:!1,appendToBody:!1,data:null,onStartDrag:z,onStopDrag:z,onDrag:z},B=function(e){function t(e,i,n){var a;return Object(T.a)(this,t),(a=Object(N.a)(this,Object(A.a)(t).call(this))).document=e,a.el=i,a.init(n),a}return Object(E.a)(t,e),Object(j.a)(t,[{key:"init",value:function(e){this.options=Object.assign({},F,!1===e?{disabled:!0}:e||{});var t=this.options;this.handle=t.handle&&this.el.querySelector(t.handle)||this.el,t.disabled||(Object(P.addClass)(this.el,"xdh-draggable"),Object(P.addClass)(this.handle,"xdh-draggable__handle"),this.on(this.handle,"mousedown",this.handleMouseDown)),this.setRange()}},{key:"setRange",value:function(){var e=this.options.target;if("string"==typeof e&&(this.options.target=this.document.querySelector(e)),this.options.target instanceof HTMLElement){var t=this.options.target.getBoundingClientRect();this.options.range={left:t.left,top:t.top,width:t.left+t.width,height:t.top+t.height}}}},{key:"reset",value:function(e){this.destroy(),this.init(e)}},{key:"handleMouseDown",value:function(e){var t=this;this.timer=setTimeout(function(){t.on(t.document,"mousemove",t.handleMouseMove),t.startDrag(e.clientX,e.clientY)},this.options.delay),this.on(this.document,"mouseup",this.handleMouseUp)}},{key:"handleMouseMove",value:function(e){this.isDragging&&(this.el.__resizable__&&this.el.__resizable__.isResizing||this.drag(e.clientX,e.clientY))}},{key:"handleMouseUp",value:function(e){clearTimeout(this.timer),this.isDragging&&(this.off(this.document,"mousemove",this.handleMouseMove),this.stopDrag(e.clientX,e.clientY)),this.off(this.document,"mouseup",this.handleMouseUp)}},{key:"setBodySelect",value:function(e){e?Object(P.addClass)(this.document.body,"user-select--none"):Object(P.removeClass)(this.document.body,"user-select--none")}},{key:"createProxy",value:function(){var e=this.options;if(e.clone){var t=null;return t="function"==typeof e.clone?e.clone(this):this.el.cloneNode(!0),Object(P.addClass)(t,"xdh-draggable__clone"),e.appendToBody?this.document.body.appendChild(t):this.el.parentNode.insertBefore(t,this.el),t}return this.el}},{key:"removeProxy",value:function(){var e=this.options;e.clone&&(e.revert?(this.on(this.dragProxy,"webkitTransitionEnd",this.handleAnimationEnd),this.on(this.dragProxy,"transitionend",this.handleAnimationEnd),Object(P.addClass)(this.dragProxy,"xdh-draggable__clone--translate"),Object(P.setStyle)(this.dragProxy,"left","".concat(this.dragData.startLeft,"px")),Object(P.setStyle)(this.dragProxy,"top","".concat(this.dragData.startTop,"px")),setTimeout(this.handleAnimationEnd.bind(this),500)):this.handleAnimationEnd())}},{key:"handleAnimationEnd",value:function(){this.dragProxy&&(this.off(this.dragProxy,"webkitTransitionEnd",this.handleAnimationEnd),this.off(this.dragProxy,"transitionend",this.handleAnimationEnd),this.dragProxy.parentNode.removeChild(this.dragProxy),this.dragProxy=null)}},{key:"startDrag",value:function(e,t){var i=this.el.offsetLeft,n=this.el.offsetTop,a=this.el.offsetWidth,o=this.el.offsetHeight;this.isDragging=!0,this.dragData={startLeft:i,startTop:n,left:i,top:n,startX:e,startY:t,width:a,height:o,offsetWidth:e-i,offsetHeight:t-n,data:this.options.data},this.options.onStartDrag(this.dragData),this.setBodySelect(!0),Object(P.addClass)(this.el,"xdh-draggable--dragging"),this.dragProxy=this.createProxy(),this.droppables=this.getDroppables()}},{key:"getDroppables",value:function(){var e=this.options;return e.group?Array.from(this.document.querySelectorAll(".xdh-droppable")).filter(function(t){if(!("none"!==t.style.display))return!1;var i=t.__droppable__.options;return!(!i.accept||i.disabled)&&i.accept.includes(e.group.trim())}):[]}},{key:"hasInRect",value:function(e,t,i){return e>i.left&&e<i.left+i.width&&t>i.top&&t<i.top+i.height}},{key:"checkDroppable",value:function(e,t){var i=this;return this.droppables.filter(function(n){var a=n.getBoundingClientRect(),o=n.__droppable__;n.entered=!!n.entered;var r=i.hasInRect(e,t,a);if(r){if(!n.entered)i.droppables.filter(function(e){return e.entered}).forEach(function(e){e.entered=!1,e.__droppable__.$emit("drag-leave",i)}),n.entered=!0,o.$emit("drag-enter",i);o.$emit("drag-over",i)}else n.entered&&(n.entered=!1,o.$emit("drag-leave",i));return r})}},{key:"getDragRange",value:function(e,t,i,n){var a=this.options.range,o={left:e,top:t};return e<a.left&&(o.left=a.left),t<a.top&&(o.top=a.top),e+i>a.width&&(o.left=a.width-i),t+n>a.height&&(o.top=a.height-n),o}},{key:"drag",value:function(e,t){var i=this.dragData,n=i.startLeft+e-i.startX,a=i.startTop+t-i.startY,o=this.getDragRange(n,a,i.width,i.height);switch(this.options.axis){case"h":i.left=o.left;break;case"v":i.top=o.top;break;default:i.left=o.left,i.top=o.top}this.applyDrag(),this.checkDroppable(e,t),this.options.onDrag(this.dragData)}},{key:"applyDrag",value:function(){var e=this.dragData;Object(P.setStyle)(this.dragProxy,"left","".concat(e.left,"px")),Object(P.setStyle)(this.dragProxy,"top","".concat(e.top,"px"))}},{key:"stopDrag",value:function(e,t){var i=this;this.isDragging=!1,this.setBodySelect(),this.options.onStopDrag(this.dragData),Object(P.removeClass)(this.el,"xdh-draggable--dragging");var n=this.checkDroppable(e,t);n.length?this.handleAnimationEnd():this.removeProxy(),n.forEach(function(e){e.entered&&e.__droppable__.$emit("drop",i,n)})}},{key:"destroy",value:function(){Object($.a)(Object(A.a)(t.prototype),"destroy",this).call(this),this.handleAnimationEnd(),this.off(this.handle,"mousedown",this.handleMouseDown),Object(P.removeClass)(this.el,"xdh-draggable"),Object(P.removeClass)(this.handle,"xdh-draggable__handle")}}]),t}(function(){function e(){Object(T.a)(this,e),this.__handlers__=[],this.__event__=new R.default({})}return Object(j.a)(e,[{key:"on",value:function(e,t,i){var n=i.bind(this),a={el:e,eventName:t,callback:i,proxy:n};this.__handlers__.push(a),Object(P.on)(e,t,n)}},{key:"$on",value:function(e,t){return this.__event__.$on.apply(this.__event__,arguments)}},{key:"off",value:function(e,t,i){var n=this;if(e){var a=arguments.length;this.__handlers__.forEach(function(o,r){switch(a){case 3:o.el===e&&o.eventName===t&&o.callback===i&&(Object(P.off)(o.el,o.eventName,o.proxy),n.__handlers__.splice(r,1));break;case 2:o.el===e&&o.eventName===t&&(Object(P.off)(o.el,o.eventName,o.proxy),n.__handlers__.splice(r,1));break;case 1:o.el===e&&(Object(P.off)(o.el,o.eventName,o.proxy),n.__handlers__.splice(r,1))}})}}},{key:"$off",value:function(e,t){return this.__event__.$off.apply(this.__event__,arguments)}},{key:"$emit",value:function(e,t){return this.__event__.$emit.apply(this.__event__,arguments)}},{key:"destroy",value:function(){this.__handlers__.forEach(function(e){Object(P.off)(e.el,e.eventName,e.proxy)}),this.__handlers__=[],this.__event__.$off(),this.__event__.$destroy()}}]),e}()),G={bind:function(e,t){e.__draggable__=new B(window.document,e,t.value)},componentUpdated:function(e,t){var i=e.__draggable__;i.options=Object.assign({},F,i.options,!1===t.value?{disabled:!0}:t.value||{})},unbind:function(e){e.__draggable__.destroy()}},W={name:"XdhGoDraft",components:{},directives:{draggable:G},props:{local:{type:Boolean},diagram:{type:Object,default:function(){return null}},visible:{type:Boolean,default:!1}},data:function(){return{draftList:[],imageDefaultOption:{size:new o.a.Size(30,30),type:"image/png"},itemName:"",draftVisible:!1}},watch:{draftVisible:function(e){this.$emit("update:visible",e)},visible:function(e){this.draftVisible=e}},computed:{style:function(){return{width:"350px"}}},methods:{close:function(){this.draftVisible=!1},save:function(){var e=this.diagram.documentBounds,t=30/e.width,i=30/e.height,n=Math.min(t,i),a=Object.assign({},this.imageDefaultOption,{scale:n}),o=this.diagram.makeImageData(a),r=new Date,s={thumb:o,name:this.itemName,time:"".concat(r.toLocaleString()," ").concat(r.toLocaleTimeString()),json:this.diagram.model.toJson()};this.draftList.push(s),this.$emit("save")},remove:function(e){var t=this.draftList.indexOf(e);this.draftList.splice(t,1)},load:function(e){this.diagram.clear(),this.diagram.model=o.a.Model.fromJson(e.json)},clear:function(){this.draftList=[],this.$emit("clear")},destroy:function(){this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)}},mounted:function(){document.body.appendChild(this.$el)},created:function(){this.draftVisible=this.visible},beforeDestroy:function(){this.destroy()}},I=Object(c.a)(W,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.draftVisible,expression:"draftVisible"},{name:"draggable",rawName:"v-draggable"}],staticClass:"xdh-go-draft",style:e.style},[e._t("default",[i("el-card",{staticClass:"xdh-go-draft__container"},[i("div",{staticClass:"xdh-go-draft__header",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("草稿箱")]),e._v(" "),i("el-button",{staticStyle:{float:"right",padding:"0"},attrs:{type:"text",circle:"",icon:"iconfont icon-multiply",size:"mini"},on:{click:e.close}})],1),e._v(" "),i("div",{staticClass:"xdh-go-draft__content"},e._l(e.draftList,function(t,n){return i("div",{key:n,staticClass:"xdh-go-draft__item"},[i("img",{staticClass:"img",attrs:{src:t.thumb}}),e._v(" "),i("span",{staticClass:"txt"},[i("div",{staticClass:"name"},[e._v(e._s(t.name))]),e._v(" "),i("div",{staticClass:"time"},[e._v(e._s(t.time))])]),e._v(" "),i("div",{staticClass:"btns"},[i("i",{staticClass:"iconfont icon-multiply remove",on:{click:function(i){return e.remove(t)}}}),e._v(" "),i("i",{staticClass:"iconfont icon-download load",on:{click:function(i){return e.load(t)}}})])])}),0),e._v(" "),i("div",{staticClass:"xdh-go-draft__footer",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save()}}},[i("el-input",{staticClass:"name-input",attrs:{size:"mini",placeholder:"输入草稿名称"},model:{value:e.itemName,callback:function(t){e.itemName=t},expression:"itemName"}}),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"iconfont icon-save"},on:{click:function(t){return e.save()}}}),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"iconfont icon-delete"},on:{click:function(t){return e.clear()}}})],1)])],{close:e.close,draftList:e.draftList,remove:e.remove,load:e.load,save:e.save,clear:e.clear})],2)},[],!1,null,"7917e6d9",null).exports;I.install=function(e){e.component(I.name,I)};var H=I,X={name:"XdhGoViewer",components:{},directives:{draggable:G},props:{diagram:{type:Object,default:function(){return null}},visible:{type:Boolean,default:!1}},data:function(){return{viewerVisible:!1,activeName:"nodes",nodes:[],links:[],others:[],clickTimeout:null,currKey:""}},computed:{style:function(){return{width:"800px"}}},watch:{viewerVisible:function(e){this.$emit("update:visible",e)},visible:function(e){this.viewerVisible=e,this.reloadDiagram()},diagram:function(e){var t=this;e&&(this.unbindEvents(),setTimeout(function(){t.bindEvents(),t.reloadDiagram()},100))}},methods:{reloadDiagram:function(){var e=this.diagram.model.toJson(),t=JSON.parse(e),i=[],n=[];t.nodeDataArray&&(i=this.getChildren(t.nodeDataArray,0)),t.linkDataArray&&(n=this.getChildren(t.linkDataArray,0));var a={};for(var o in t)["nodeDataArray","linkDataArray"].includes(o)||(a[o]=t[o]);var r=this.getChildren(a,0);this.nodes=i,this.links=n,this.others=r},getChildren:function(e,t){var i=this;if(e instanceof Array){var n=[];return e.forEach(function(e){var a={data:e,level:t};0===t&&(e.key?a.key=e.key:e.from&&(a.key="".concat(e.from,"_").concat(e.to)));var o=i.getChildren(e,t+1);o instanceof Array?(a.children=o,a.label=JSON.stringify(e).substr(0,50)):a.label="string"==typeof e?"".concat(name,":  '").concat(e,"'"):"".concat(name,":  ").concat(e),n.push(a)}),n}if(e instanceof Object){var a=[];for(var o in e){var r=e[o],s={data:r,level:t},l=this.getChildren(r,t+1);l instanceof Array?(s.children=l,s.label="".concat(o,":  ").concat(JSON.stringify(r).substr(0,50))):s.label="string"==typeof r?"".concat(o,":  '").concat(r,"'"):"".concat(o,":  ").concat(r),a.push(s)}return a}return e},findNode:function(e){var t=this.diagram.model.nodeDataArray.find(function(t){return t.key===e.data.key});if(t){var i=this.diagram.findNodeForData(t);console.log(i),this.diagram.clearSelection(),i.isSelected=!0;var n=i.actualBounds;this.diagram.centerRect(n),this.currKey=i.data.key}else{var a=this.diagram.model.linkDataArray.find(function(t){return t.from===e.data.from&&t.to===e.data.to});if(a){var o=this.diagram.findLinkForData(a);if(this.diagram.clearSelection(),o){o.isSelected=!0;var r=o.actualBounds;this.diagram.centerRect(r),this.currKey="".concat(o.data.from,"_").concat(o.data.to)}}}},close:function(){this.viewerVisible=!1},destroy:function(){this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},objectClick:function(e){var t=this;this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(function(){var i=e.subject.part.data;i.key?(t.activeName="nodes",t.currKey=i.key):i.from&&(t.activeName="links",t.currKey="".concat(i.from,"_").concat(i.to))},300)},objectDbClick:function(e){this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(function(){console.log(e,"dbclick")},300)},bindEvents:function(){this.diagram.addDiagramListener("ObjectSingleClicked",this.objectClick),this.diagram.addDiagramListener("ObjectDoubleClicked",this.objectDbClick)},unbindEvents:function(){this.diagram.removeDiagramListener("ObjectSingleClicked",this.objectClick),this.diagram.removeDiagramListener("ObjectDoubleClicked",this.objectDbClick)}},created:function(){this.viewerVisible=this.visible},mounted:function(){document.body.appendChild(this.$el),this.diagram&&this.reloadDiagram()},beforeDestroy:function(){this.destroy(),this.unbindEvents()}},K=Object(c.a)(X,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.viewerVisible,expression:"viewerVisible"},{name:"draggable",rawName:"v-draggable"}],staticClass:"xdh-go-viewer",style:e.style},[e._t("default",[i("el-card",{staticClass:"xdh-go-viewer__container"},[i("div",{staticClass:"xdh-go-viewer__header",attrs:{slot:"header"},slot:"header"},[i("span",[e._v("数据管理器")]),e._v(" "),i("el-button",{staticStyle:{float:"right",padding:"0"},attrs:{type:"text",circle:"",icon:"iconfont icon-multiply",size:"mini"},on:{click:e.close}})],1),e._v(" "),i("div",{staticClass:"xdh-go-viewer__content"},[i("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"节点信息",name:"nodes"}},[i("el-tree",{ref:"nodeTree",attrs:{data:e.nodes,"expand-on-click-node":!1,"node-key":"key"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return[i("div",{class:["item",{active:a.key===e.currKey}],on:{click:function(t){return t.preventDefault(),e.findNode(a)}}},[0===a.level?i("span",[e._v("\n                    "+e._s(n.label)+"\n                    "),i("i",{staticClass:"iconfont icon-inquiry search",on:{click:function(t){return t.preventDefault(),e.findNode(a)}}})]):i("span",[e._v(e._s(n.label))])])]}}])})],1),e._v(" "),i("el-tab-pane",{attrs:{label:"关系信息",name:"links"}},[i("el-tree",{ref:"linkTree",attrs:{data:e.links,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return[i("div",{class:["item",{active:a.data.from+"_"+a.data.to===e.currKey}],on:{click:function(t){return t.preventDefault(),e.findNode(a)}}},[0===a.level?i("span",[e._v("\n                    "+e._s(n.label)+"\n                    "),i("i",{staticClass:"iconfont icon-inquiry search",on:{click:function(t){return t.preventDefault(),e.findNode(a)}}})]):i("span",[e._v(e._s(n.label))])])]}}])})],1),e._v(" "),i("el-tab-pane",{attrs:{label:"其它",name:"others"}},[i("el-tree",{attrs:{data:e.others,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return[i("div",{staticClass:"item"},[0===a.level?i("span",[e._v("\n                    "+e._s(n.label)+"\n                    "),i("i",{staticClass:"iconfont icon-inquiry search",on:{click:function(t){return t.preventDefault(),e.findNode(a)}}})]):i("span",[e._v(e._s(n.label))])])]}}])})],1)],1)],1)])])],2)},[],!1,null,"8a2551c4",null).exports;K.install=function(e){e.component(K.name,K)};var V={name:"XdhGoTool",components:{XdhGoDraft:H,XdhGoViewer:K},directives:{draggable:G},props:{diagram:{type:Object,default:function(){return null}}},data:function(){return{collapsed:!1,draftShow:!1,viewerShow:!1,dragOption:{handle:".xdh-go-tool__handle"}}},computed:{},methods:{clear:function(){this.diagram.clear()},draft:function(){this.draftShow=!this.draftShow},viewDiagram:function(){this.viewerShow=!this.viewerShow,console.log(this.diagram.model.toJson())}},created:function(){},mounted:function(){document.body.appendChild(this.$el)},beforeDestroy:function(){this.$refs.draft.destroy(),this.$refs.viewer.destroy(),this.$el.parentNode.removeChild(this.$el)}},J=Object(c.a)(V,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"draggable",rawName:"v-draggable",value:e.dragOption,expression:"dragOption"}],class:["xdh-go-tool",{collapsed:e.collapsed}]},[i("div",{staticClass:"expand"},[i("i",{staticClass:"iconfont icon-expand btn",on:{click:function(t){t.preventDefault(),e.collapsed=!e.collapsed}}})]),e._v(" "),i("div",{class:"xdh-go-tool__handle"},[i("span",{staticClass:"title"},[e._v("\n      gojs开发工具条\n      "),i("i",{staticClass:"iconfont icon-mid btn",on:{click:function(t){t.preventDefault(),e.collapsed=!e.collapsed}}})])]),e._v(" "),i("div",{staticClass:"xdh-go-tool__container"},[i("el-tooltip",{attrs:{effect:"dark",content:"清空画布",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"iconfont icon-delete"},on:{click:function(t){return e.clear()}}})],1),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:"草稿箱",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"iconfont icon-paste"},on:{click:function(t){return e.draft()}}})],1),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:"查看图数据",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"primary",circle:"",icon:"iconfont icon-collaboration"},on:{click:function(t){return e.viewDiagram()}}})],1)],1),e._v(" "),i("xdh-go-draft",{ref:"draft",attrs:{visible:e.draftShow,diagram:e.diagram},on:{"update:visible":function(t){e.draftShow=t}}}),e._v(" "),i("xdh-go-viewer",{ref:"viewer",attrs:{visible:e.viewerShow,diagram:e.diagram},on:{"update:visible":function(t){e.viewerShow=t}}})],1)},[],!1,null,"5b1ec6d9",null).exports;J.install=function(e){e.component(J.name,J)};var q=J,U={};var Y={GridLayout:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},U,{wrappingColumn:10,sorting:t.GridLayout.Forward,spacing:new t.Size(50,50)},i);return e(t.GridLayout,n)},CircularLayout:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},U,{arrangement:t.CircularLayout.Packed,spacing:10},i);return e(t.CircularLayout,n)},LayeredDigraphLayout:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},U,{layerSpacing:80,columnSpacing:30,layeringOption:t.LayeredDigraphLayout.LayerLongestPathSource},i);return e(t.LayeredDigraphLayout,n)},ForceDirectedLayout:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},U,{arrangementSpacing:new t.Size(100,100),defaultElectricalCharge:50,defaultSpringLength:10,defaultSpringStiffness:.01},i);return e(t.ForceDirectedLayout,n)},TreeLayout:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},U,i);return e(t.TreeLayout,n)}},Q=o.a.GraphObject.make,Z={name:"XdhGoLayout",components:{},props:{diagram:{type:Object,default:function(){return null}},lock:{type:Boolean,default:!1}},data:function(){return{currLayout:"LayeredDigraphLayout",lockState:!1,currOption:{}}},watch:{lock:{immediate:!0,handler:function(e){this.lockState=e}},lockState:function(e){this.$emit("update:lock",e)},diagram:{handler:function(e){var t=this;e&&(this.unbindEvents(),setTimeout(function(){t.bindEvents()},100))}}},computed:{},methods:{toggleLock:function(){if(this.lockState=!this.lockState,this.lockState){var e=Q(o.a.Layout);this.diagram.layout=e,this.diagram.layoutDiagram(!0)}else{var t=this.currLayout,i=this.currOption;if("GridLayout"===t){var n=this.diagram.model.nodeDataArray.length,a=Math.floor(Math.sqrt(n))+1;i.wrappingColumn=a}var r=this.getAllNodesAndLinks();this.setNodesFixed(r,!1);var s=Y[t](Q,o.a,i);s.isOngoing=!0,this.diagram.layout=s,this.diagram.layoutDiagram(!0)}},changeLayout:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.$emit("change",e),this.currOption=t,this.currLayout=e,this.lockState)if(this.diagram.layout=Q(o.a.Layout),this.diagram.layoutDiagram(!0),0!==this.diagram.selection.count){var i,n,a=new o.a.Set;this.diagram.selection.each(function(e){a.add(e),(!i||e.position.x<i)&&(i=e.position.x),(!n||e.position.y<n)&&(n=e.position.y)});var r=new o.a.Point(i,n);this.layoutNodes(Q,o.a,e,a,r,t)}else{var s=this.getAllNodesAndLinks();this.setNodesFixed(s,!0),this.layoutNodes(Q,o.a,e,s,void 0,t)}else{var l;if(0!==this.diagram.selection.count?(l=new o.a.Set,this.diagram.nodes.each(function(e){e.isLayoutPositioned=!1}),this.diagram.selection.each(function(e){l.add(e)})):l=this.getAllNodesAndLinks(),this.setNodesFixed(l,!1),"GridLayout"===e){var c=this.diagram.model.nodeDataArray.length,d=Math.floor(Math.sqrt(c))+1;t.wrappingColumn=d}var u=Y[e](Q,o.a,t);u.isOngoing=!0,this.diagram.layout=u,this.diagram.layoutDiagram(!0)}},getAllNodesAndLinks:function(){var e=new o.a.Set;return this.diagram.nodes.each(function(t){e.add(t)}),this.diagram.links.each(function(t){e.add(t)}),e},layoutNodes:function(e,t,i,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if("GridLayout"===i){var r=this.diagram.model.nodeDataArray.length,s=Math.floor(Math.sqrt(r))+1;o.wrappingColumn=s}var l=Y[i](e,t,o);this.diagram.layout.isOngoing=!1,this.setNodesFixed(n,!1),l.doLayout(n),this.setNodesFixed(n,!0),this.diagram.layout.isOngoing=!0,a&&"ForceDirectedLayout"!==i&&this.diagram.moveParts(n,a)},setNodesFixed:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.each(function(e){e.isLayoutPositioned=!t})},layoutAfterAdd:function(e,t){var i=this;if(!e||0!==e.length){var n={},a="data";e[0].diagram&&(a="node"),e.forEach(function(e){n[e.key]=e});var r=null;if(e.forEach(function(e){var t;(t="node"===a?e:i.diagram.findNodeForData(e))&&t.findNodesConnected().each(function(e){n[e.key]||(r=e)})}),!r)("node"===a?e[0]:this.diagram.findNodeForData(e[0])).findNodesConnected().each(function(e){r=e});var s=new o.a.Set,l=r.findTreeChildrenNodes(),c=r.findTreeChildrenLinks(),d=r.position.x,u=r.position.y;s.add(r),l&&l.each(function(e){s.add(e),0!==e.position.x&&0!==e.position.y&&((!d||e.position.x<d)&&(d=e.position.x),(!u||e.position.y<u)&&(u=e.position.y))});var h=new o.a.Point(d,u);e.forEach(function(e){var t;(t="node"===a?e:i.diagram.findNodeForData(e)).position=h,s.add(t)}),t&&0!==t.length&&t.forEach(function(e){var t;t="node"===a?e:i.diagram.findLinkForData(e),s.add(t)}),c&&c.each(function(e){s.add(e)}),this.layoutNodes(Q,o.a,this.currLayout,s,h,this.currOption)}},bindEvents:function(){},unbindEvents:function(){}},created:function(){}},ee=Object(c.a)(Z,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xdh-go-layout__menu"},[e._t("default",[i("ul",[i("li",{on:{click:function(t){return e.toggleLock()}}},[i("el-tooltip",{attrs:{content:"固定布局切换",placement:"left",effect:"light"}},[e.lock?i("i",{staticClass:"iconfont icon-pin icon"}):e._e(),e._v(" "),e.lock?e._e():i("i",{staticClass:"iconfont icon-map-thumbtack icon"})])],1),e._v(" "),i("li",[i("el-tooltip",{attrs:{content:"分层",placement:"left",effect:"light","popper-class":"invest-graph"}},[i("i",{staticClass:"iconfont icon-Tandem icon"})]),e._v(" "),i("ul",[i("li",{on:{click:function(t){return e.changeLayout("LayeredDigraphLayout",{direction:270})}}},[i("i",{staticClass:"iconfont icon-arrow-up icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("LayeredDigraphLayout",{direction:90})}}},[i("i",{staticClass:"iconfont icon-arrow-down icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("LayeredDigraphLayout",{direction:180})}}},[i("i",{staticClass:"iconfont icon-arrow-left icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("LayeredDigraphLayout",{direction:0})}}},[i("i",{staticClass:"iconfont icon-arrow-right icon"})])])],1),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("ForceDirectedLayout")}}},[i("el-tooltip",{attrs:{content:"力导向",placement:"left",effect:"light","popper-class":"invest-graph"}},[i("i",{staticClass:"iconfont icon-relation icon"})])],1),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("GridLayout")}}},[i("el-tooltip",{attrs:{content:"网格",placement:"left",effect:"light","popper-class":"invest-graph"}},[i("i",{staticClass:"iconfont icon-nine-squares icon"})])],1),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("CircularLayout")}}},[i("el-tooltip",{attrs:{content:"圆形",placement:"left",effect:"light","popper-class":"invest-graph"}},[i("i",{staticClass:"iconfont icon-collaboration-system icon"})])],1),e._v(" "),i("li",[i("el-tooltip",{attrs:{content:"树形",placement:"left",effect:"light","popper-class":"invest-graph"}},[i("i",{staticClass:"iconfont icon-map-site icon"})]),e._v(" "),i("ul",[i("li",{on:{click:function(t){return e.changeLayout("TreeLayout",{angle:270})}}},[i("i",{staticClass:"iconfont icon-arrow-up icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("TreeLayout",{angle:90})}}},[i("i",{staticClass:"iconfont icon-arrow-down icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("TreeLayout",{angle:180})}}},[i("i",{staticClass:"iconfont icon-arrow-left icon"})]),e._v(" "),i("li",{on:{click:function(t){return e.changeLayout("TreeLayout",{angle:0})}}},[i("i",{staticClass:"iconfont icon-arrow-right icon"})])])],1)])],{toggleLock:e.toggleLock,changeLayout:e.changeLayout})],2)},[],!1,null,"7f2e5082",null).exports;ee.install=function(e){e.component(ee.name,ee)};var te=ee,ie=[{name:"显示照片",icon:"iconfont icon-image",visible:!1},{name:"隐藏",icon:"iconfont icon-magic",subMenu:[{name:"隐藏节点"},{name:"隐藏子节点"},{name:"隐藏关系label"},{name:"隐藏关系连线"}]},{name:"显示",icon:"iconfont icon-enlarge",subMenu:[{name:"显示子节点"},{name:"显示关系label"},{name:"显示关系连线"}]},{name:"查看全部",icon:"iconfont icon-bullseye"},{name:"缩小",icon:"iconfont icon-zoomout"},{name:"放大",icon:"iconfont icon-enlarge"}],ne={name:"XdhGoView",components:{},props:{diagram:{type:Object,default:function(){return null}}},data:function(){return{menus:ie.filter(function(e){return!1!==e.visible}),disabledAll:!1}},computed:{},methods:{toggleDisabledAll:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.disabledAll=e},menuClick:function(e){this.$emit("item-click",e);var t=new o.a.Set,i=this.diagram,n=i.model;switch(e){case"隐藏节点":i.selection.each(function(e){e instanceof o.a.Node&&t.add(e)}),t.each(function(e){e.visible=!1});break;case"隐藏关系label":n.setDataProperty(this.diagram.model.modelData,"showLinkLabels",!1);break;case"隐藏关系连线":n.setDataProperty(this.diagram.model.modelData,"showLinks",!1);break;case"隐藏子节点":i.selection.each(function(e){e instanceof o.a.Node&&t.add(e)}),t.each(function(e){e.collapseTree(1)});break;case"显示子节点":i.selection.each(function(e){e instanceof o.a.Node&&t.add(e)}),t.each(function(e){e.expandTree(1),e.findTreeChildrenNodes().each(function(e){e.visible=!0})});break;case"显示关系label":n.setDataProperty(n.modelData,"showLinkLabels",!0);break;case"显示关系连线":n.setDataProperty(n.modelData,"showLinks",!0);break;case"查看全部":i.zoomToFit();break;case"缩小":i.scale=i.scale-.2;break;case"放大":i.scale=i.scale+.2}}},created:function(){}},ae=(i(316),Object(c.a)(ne,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._t("default",[i("div",{staticClass:"xdh-go__menu"},e._l(e.menus,function(t,n){return i("div",{key:n,class:{"xdh-go__box":!0,disabled:t.disabled||e.disabledAll}},[t.subMenu?e._e():i("div",{on:{click:function(i){return e.menuClick(t.name)}}},[i("div",{staticClass:"icon-con"},[i("i",{class:t.icon})]),e._v(" "),i("div",{staticClass:"box"},[e._v(e._s(t.name))])]),e._v(" "),t.subMenu?i("div",[i("div",{staticClass:"icon-con"},[i("i",{class:t.icon})]),e._v(" "),i("el-dropdown",{staticClass:"submenu",attrs:{trigger:"click"},on:{command:function(t){return e.menuClick(t)}}},[i("span",{class:{"el-dropdwon-link":!0,disabled:t.disabled||e.disabledAll}},[e._v("\n              "+e._s(t.name)+"\n              "),i("i",{staticClass:"iconfont icon-bold-arrow-down",staticStyle:{"margin-left":"5px"}})]),e._v(" "),i("el-dropdown-menu",{staticClass:"xdh-go__dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},e._l(t.subMenu,function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t.name,disabled:t.disabled}},[e._v(e._s(t.name))])}),1)],1)],1):e._e()])}),0)])],2)},[],!1,null,"5cc174aa",null).exports);ae.install=function(e){e.component(ae.name,ae)};var oe=ae,re=[{name:"选择",icon:"iconfont icon-indicator",subMenu:[{name:"框选",tips:"点击框选或按住shift点击鼠标左键可框选"},{name:"多选",tips:"点击多选或按住ctrl可多选"},{name:"全选",tips:"全选节点"},{name:"反选",tips:"反选节点"},{name:"选中子节点",tips:"选中指定节点的子节点"}]}],se={name:"XdhGoSelect",components:{},props:{diagram:{type:Object,default:function(){return null}},showTips:{type:Boolean,default:!0}},watch:{diagram:{handler:function(e){var t=this;e&&(this.unbindDiagramEvent(),setTimeout(function(){t.bindDiagramEvent(e,o.a.GraphObject.make,o.a)},300))}}},data:function(){return{menus:re.filter(function(e){return!1!==e.visible}),disabledAll:!1,selectMode:"normal",selectModeMap:{normal:"",rect:"框选",multi:"多选",all:"全选",reverse:"反选",child:"选中子节点"}}},computed:{alertTips:function(){return"rect"===this.selectMode?"开始框选，按住ctrl可框选多处，点击esc退出":"multi"===this.selectMode?"开始多选，点击esc退出":"切换到普通模式"}},methods:{keyupHandler:function(e){switch(e.preventDefault(),e.key){case"Escape":this.resetMode()}},resetMode:function(){this.setSelectMode("normal")},toggleDisabledAll:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.disabledAll=e},setSelectMode:function(e){var t=this,i=this.diagram,n=i.model;if(n.setDataProperty(n.modelData,"selectMode",e),this.selectMode=e,i.clearHighlighteds(),"rect"===e)i.toolManager.dragSelectingTool.delay=0;else if("all"===e)i.commandHandler.selectAll();else if("reverse"===e)i.nodes.each(function(e){e.isSelected=!e.isSelected});else if("child"===e){var a=this.getSelections(!0),r=new o.a.Set;a.each(function(e){r.add(e)}),i.clearSelection(),r.each(function(e){t.selectChildren(e)})}else"multi"===e?i.clearSelection():"normal"===e&&(this.diagram.toolManager.dragSelectingTool.delay=200);this.$emit("change",e)},getSelections:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e)return this.diagram.selection;var t=[];return this.diagram.selection.each(function(e){t.push(e.data)}),t},selectChildren:function(e){var t=e.findTreeChildrenNodes();t&&t.each(function(e){e.isSelected=!0})},menuClick:function(e){switch(this.$emit("item-click",e),e){case"框选":this.setSelectMode("rect");break;case"多选":this.setSelectMode("multi");break;case"全选":this.setSelectMode("all");break;case"反选":this.setSelectMode("reverse");break;case"选中子节点":this.setSelectMode("child")}},bindDiagramEvent:function(e,t,i){var n=this;this.diagram.addDiagramListener("BackgroundSingleClicked",this.backgroundClick),e.addDiagramListener("ObjectSingleClicked",this.nodeClickSelect),e.commandHandler.doKeyDown=function(){var t=e.lastInput,n=e.commandHandler;"Esc"!==t.key&&i.CommandHandler.prototype.doKeyDown.call(n)},e.toolManager.clickSelectingTool.doMouseUp=function(){var t=e.lastInput,a=e.toolManager.clickSelectingTool;if(["multi"].includes(n.selectMode)){if(console.log("multi"),0===t.button){var o=e.findObjectAt(t.documentPoint,function(e){return e.part},function(e){return e.canSelect()});o&&(o.isSelected=!0),e.clearHighlighteds()}}else console.log("not multi"),i.ClickSelectingTool.prototype.doMouseUp.call(a)},e.toolManager.draggingTool.doMouseMove=function(){var t=e.toolManager.draggingTool;i.DraggingTool.prototype.doMouseMove.call(t),e.layout.invalidateLayout()}},nodeClickSelect:function(e){console.log("select node");var t=e.subject.part,i=!1;return"multi"===this.selectMode?(this.diagram.clearHighlighteds(),i=!0):this.diagram.clearSelection(),t.isSelected=!0,i},backgroundClick:function(){console.log("ffffff"),this.resetMode(),this.diagram.clearSelection()},unbindDiagramEvent:function(){this.diagram.removeDiagramListener("BackgroundSingleClicked",this.backgroundClick),this.diagram.removeDiagramListener("ObjectSingleClicked",this.nodeClickSelect),this.diagram.toolManager.draggingTool.doMouseMove=o.a.DraggingTool.prototype.doMouseMove,this.diagram.toolManager.clickSelectingTool.doMouseUp=o.a.ClickSelectingTool.prototype.doMouseUp,this.diagram.commandHandler.doKeyDown=o.a.CommandHandler.prototype.doKeyDown}},mounted:function(){window.addEventListener("keyup",this.keyupHandler)},beforeDestroy:function(){window.removeEventListener("keyup",this.keyupHandler),this.unbindDiagramEvent()}},le=Object(c.a)(se,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.showTips?i("el-alert",{directives:[{name:"show",rawName:"v-show",value:["rect","multi"].includes(e.selectMode),expression:"['rect', 'multi'].includes(selectMode)"}],staticClass:"xdh-go__tips",attrs:{title:""+e.alertTips,closable:!1,type:"warning"}}):e._e(),e._v(" "),e._t("default",[i("div",{staticClass:"xdh-go__menu"},e._l(e.menus,function(t,n){return i("div",{key:n,class:{"xdh-go__box":!0,disabled:t.disabled||e.disabledAll}},[t.subMenu?e._e():i("div",{on:{click:function(i){return e.menuClick(t.name)}}},[i("div",{staticClass:"icon-con"},[i("i",{class:t.icon})]),e._v(" "),i("div",{staticClass:"box"},[e._v(e._s(t.name))])]),e._v(" "),t.subMenu?i("div",[i("div",{staticClass:"icon-con"},[i("i",{class:t.icon})]),e._v(" "),i("el-dropdown",{staticClass:"submenu",attrs:{trigger:"click"},on:{command:function(t){return e.menuClick(t)}}},[i("span",{class:{"el-dropdwon-link":!0,disabled:t.disabled||e.disabledAll}},[e._v("\n              "+e._s(t.name)+"\n              "),i("i",{staticClass:"iconfont icon-bold-arrow-down",staticStyle:{"margin-left":"5px"}})]),e._v(" "),i("el-dropdown-menu",{staticClass:"xdh-go__dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},e._l(t.subMenu,function(t,n){return i("el-dropdown-item",{key:n,class:{active:t.name===e.selectModeMap[e.selectMode]},attrs:{command:t.name,disabled:t.disabled}},[e._v(e._s(t.name))])}),1)],1)],1):e._e()])}),0)])],2)},[],!1,null,"35980770",null).exports;le.install=function(e){e.component(le.name,le)};var ce=le,de=(i(317),{name:"XdhGoSearch",components:{},props:{diagram:{type:Object,default:function(){return null}},pullCenter:{type:Boolean,default:!0},ignoreCase:{type:Boolean,default:!0},nodeKeys:{type:Array,default:function(){return["key"]}},linkKeys:{type:Array,default:function(){return["key"]}},mode:{type:String,default:function(){return"node"},validator:function(e){return["node","link","node,link"].includes(e)}}},data:function(){return{keyword:"",keywordCache:"",resultCache:[],index:0}},computed:{},methods:{search:function(){if(this.keyword)if(this.keyword===this.keywordCache?this.index=(this.index+1)%this.resultCache.length:this.index=0,this.searchNode(),0!==this.resultCache.length){var e=this.resultCache[this.index];if(e.isSelected=!0,this.pullCenter){var t=e.actualBounds;this.diagram.centerRect(t)}this.$emit("search",e,this.resultCache,this.index,this.keyword)}else this.$emit("error","no-result");else this.$emit("error","keyword-empty")},searchNode:function(){var e=this;this.keywordCache=this.keyword,this.diagram.clearSelection();var t=[];this.mode.includes("node")&&this.diagram.nodes.each(function(i){var n=!1;e.nodeKeys.forEach(function(t){var a=t.split("."),o=e.getData(i.data,a);"string"==typeof o&&(e.ignoreCase?o.toLowerCase().includes(e.keyword.toLowerCase())&&(n=!0):o.includes(e.keyword)&&(n=!0))}),n&&t.push(i)}),this.mode.includes("link")&&this.diagram.links.each(function(i){var n=!1;e.linkKeys.forEach(function(a){var o=a.split("."),r=e.getData(i.data,o);e.ignoreCase&&("string"==typeof r?r.toLowerCase().includes(e.keyword.toLowerCase())&&(n=!0):r.includes(e.keyword)&&(n=!0)),n&&t.push(i)})}),0!==t.length?this.resultCache=t:this.resultCache=[]},getData:function(e,t){if(0!==t.length){var i=t.shift();return e[i]?this.getData(e[i],t):""}return e}},created:function(){}}),ue=Object(c.a)(de,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xdh-go-search",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}}},[e._t("default",[i("el-input",{staticClass:"xdh-go-search__input",attrs:{placeholder:"输入检索内容",size:"small",clearable:""},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],{search:e.search,keyword:e.keyword})],2)},[],!1,null,"5f331884",null).exports;ue.install=function(e){e.component(ue.name,ue)};var he=ue,fe=[u,m,v,x,L,O,H,q,te,oe,ce,he],me=function e(t){e.installed||fe.forEach(function(e){return t.component(e.name,e)})};"undefined"!=typeof window&&window.Vue&&me(window.Vue);var pe={components:{XdhGo:u},data:function(){return{model:"GraphLinksModel",nodes:[{key:"A",category:"a"},{key:"B",category:"b"},{key:"C",category:"c"}],links:[{from:"A",to:"B"},{from:"A",to:"C"}]}},methods:{config:function(e,t){return{initialContentAlignment:t.Spot.Center}},nodeTemplate:function(e,t,i){return e(t.Node,"Horizontal",{background:i},e(t.TextBlock,"Default Text",{margin:12,stroke:"#ffffff"},new t.Binding("text","key")))},linkTemplate:function(e,t){return e(t.Link,{routing:t.Link.Orthogonal,corner:5},e(t.Shape,{strokeWidth:3,stroke:"#555"}))},nodeTemplateMap:function(e,t){var i=this.nodeTemplate(e,t,"red"),n=this.nodeTemplate(e,t,"blue"),a=this.nodeTemplate(e,t,"green"),o=new t.Map;return o.add("a",i),o.add("b",n),o.add("c",a),o},layout:function(e,t){return new t.TreeLayout}}},ge=Object(c.a)(pe,function(){var e=this.$createElement;return(this._self._c||e)("xdh-go",{attrs:{nodes:this.nodes,links:this.links,type:this.model,"node-template-map":this.nodeTemplateMap,"link-template":this.linkTemplate,config:this.config,layout:this.layout,height:"200px"}})},[],!1,null,null,null);t.default=ge.exports}}]);